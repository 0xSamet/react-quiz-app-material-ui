{"ast":null,"code":"import axios from \"axios\";\nimport jwt from \"jsonwebtoken\";\nconst INITIAL_STATE = {\n  loginError: \"\",\n  isFetching: false,\n  isAuthenticated: false,\n  token: \"\",\n  user: {}\n};\nconst LOGIN_START = \"LOGIN_START\";\nconst LOGIN_FAILURE = \"LOGIN_FAILURE\";\nconst LOGIN_SUCCESS = \"LOGIN_SUCCESS\";\nconst LOGOUT_SUCCESS = \"LOGOUT_SUCCESS\";\nexport const loginStart = () => ({\n  type: LOGIN_START\n});\nexport const loginFailure = message => ({\n  type: LOGIN_FAILURE,\n  payload: {\n    message\n  }\n});\nexport const loginSuccess = (token, user) => ({\n  type: LOGIN_SUCCESS,\n  payload: {\n    token,\n    user\n  }\n});\nexport const logoutSuccess = () => ({\n  type: LOGOUT_SUCCESS\n});\nexport const login = user => async dispatch => {\n  try {\n    dispatch(loginStart());\n    const result = await axios.post(`${process.env.REACT_APP_API_BASE_URL}/oturum/girisyap`, user);\n\n    if (result.status === 202) {\n      jwt.verify(result.data.token, process.env.REACT_APP_JWT_SECRET, (err, user) => {\n        if (err) {\n          dispatch(loginFailure(err.message));\n        }\n\n        if (localStorage.getItem(\"token\")) {\n          localStorage.removeItem(\"token\");\n        }\n\n        localStorage.setItem(\"token\", result.data.token);\n        dispatch(loginSuccess(result.data.token, user));\n      });\n      return;\n    }\n\n    throw new Error(result.data.message);\n  } catch (err) {\n    dispatch(loginFailure(err.message));\n  }\n};\nexport const logout = () => dispatch => {\n  dispatch(logoutSuccess());\n\n  if (localStorage.getItem(\"token\")) {\n    localStorage.removeItem(\"token\");\n  }\n};\nexport const authReducer = (state = INITIAL_STATE, action) => {\n  switch (action.type) {\n    case LOGIN_START:\n      return { ...state,\n        isFetching: true,\n        isAuthenticated: false,\n        user: {}\n      };\n\n    case LOGIN_SUCCESS:\n      return { ...state,\n        isFetching: false,\n        isAuthenticated: true,\n        token: action.payload.token,\n        user: action.payload.user\n      };\n\n    case LOGIN_FAILURE:\n      return { ...state,\n        isFetching: false,\n        isAuthenticated: false,\n        loginError: action.payload.message,\n        user: {}\n      };\n\n    case LOGOUT_SUCCESS:\n      return { ...state,\n        isAuthenticated: false,\n        token: \"\",\n        user: {}\n      };\n\n    default:\n      return state;\n  }\n};","map":{"version":3,"sources":["/Users/samet/dev/cv/react-quiz-app-ui/src/store/auth.js"],"names":["axios","jwt","INITIAL_STATE","loginError","isFetching","isAuthenticated","token","user","LOGIN_START","LOGIN_FAILURE","LOGIN_SUCCESS","LOGOUT_SUCCESS","loginStart","type","loginFailure","message","payload","loginSuccess","logoutSuccess","login","dispatch","result","post","process","env","REACT_APP_API_BASE_URL","status","verify","data","REACT_APP_JWT_SECRET","err","localStorage","getItem","removeItem","setItem","Error","logout","authReducer","state","action"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport jwt from \"jsonwebtoken\";\n\nconst INITIAL_STATE = {\n  loginError: \"\",\n  isFetching: false,\n  isAuthenticated: false,\n  token: \"\",\n  user: {},\n};\n\nconst LOGIN_START = \"LOGIN_START\";\nconst LOGIN_FAILURE = \"LOGIN_FAILURE\";\nconst LOGIN_SUCCESS = \"LOGIN_SUCCESS\";\nconst LOGOUT_SUCCESS = \"LOGOUT_SUCCESS\";\n\nexport const loginStart = () => ({\n  type: LOGIN_START,\n});\n\nexport const loginFailure = (message) => ({\n  type: LOGIN_FAILURE,\n  payload: {\n    message,\n  },\n});\n\nexport const loginSuccess = (token, user) => ({\n  type: LOGIN_SUCCESS,\n  payload: {\n    token,\n    user,\n  },\n});\n\nexport const logoutSuccess = () => ({\n  type: LOGOUT_SUCCESS,\n});\n\nexport const login = (user) => async (dispatch) => {\n  try {\n    dispatch(loginStart());\n    const result = await axios.post(\n      `${process.env.REACT_APP_API_BASE_URL}/oturum/girisyap`,\n      user\n    );\n    if (result.status === 202) {\n      jwt.verify(\n        result.data.token,\n        process.env.REACT_APP_JWT_SECRET,\n        (err, user) => {\n          if (err) {\n            dispatch(loginFailure(err.message));\n          }\n          if (localStorage.getItem(\"token\")) {\n            localStorage.removeItem(\"token\");\n          }\n          localStorage.setItem(\"token\", result.data.token);\n          dispatch(loginSuccess(result.data.token, user));\n        }\n      );\n      return;\n    }\n    throw new Error(result.data.message);\n  } catch (err) {\n    dispatch(loginFailure(err.message));\n  }\n};\n\nexport const logout = () => (dispatch) => {\n  dispatch(logoutSuccess());\n  if (localStorage.getItem(\"token\")) {\n    localStorage.removeItem(\"token\");\n  }\n};\n\nexport const authReducer = (state = INITIAL_STATE, action) => {\n  switch (action.type) {\n    case LOGIN_START:\n      return { ...state, isFetching: true, isAuthenticated: false, user: {} };\n    case LOGIN_SUCCESS:\n      return {\n        ...state,\n        isFetching: false,\n        isAuthenticated: true,\n        token: action.payload.token,\n        user: action.payload.user,\n      };\n    case LOGIN_FAILURE:\n      return {\n        ...state,\n        isFetching: false,\n        isAuthenticated: false,\n        loginError: action.payload.message,\n        user: {},\n      };\n    case LOGOUT_SUCCESS:\n      return { ...state, isAuthenticated: false, token: \"\", user: {} };\n    default:\n      return state;\n  }\n};\n"]},"metadata":{},"sourceType":"module"}